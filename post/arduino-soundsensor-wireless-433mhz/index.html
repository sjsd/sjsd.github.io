<!doctype html> 
<html lang="no-nb"> 
<head>
  <meta charset="utf-8">
  <title>SJSD - blogg og notater om mine DIY</title>
  <meta name="author" content="Helge Johnsen">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png" />
  
  
  <link rel="stylesheet" href="/style.css" />
  <link href='//fonts.googleapis.com/css?family=Merriweather:400,700' rel='stylesheet' type='text/css'>

</head>
<body>

  <div class="wrap">
    <header class="mb">
      <h1 class="h2 m-0"><a href="/">SJSD - blogg og notater om mine DIY</a></h1>
      <p></p>
    </header>


<main>
<article class="post">
  <h1><a href="http://sjsd.github.io/post/arduino-soundsensor-wireless-433mhz/" title="Arduino, lydsensor og 433MHz kommunikasjon">Arduino, lydsensor og 433MHz kommunikasjon</a></h1>
  

<p>Dette er en del av et litt større prosjekt jeg jobber med. Det er ikke sikkert dette er den endelige løsningen for prosjektet mitt, men det er en del av det å prøve å feile.</p>

<h2 id="hardware:676f01acec179ba34e80d79ca9ddd325">Hardware</h2>

<p>I oppsettet har jeg to Arduinoer, en lydsensor, et sett 433Mhz RF (sender og mottaker) og LED. Jeg har da «krydret» det med å bruke en <a href="https://www.adafruit.com/products/3039" title="Adafruit Neopixel stick">Adafruit Neopixel stick</a>.</p>

<p>Lydsensoren er av en type som kun oppfatter volum og ikke type lyd. Så om det er ei bjelle, en hund som bjeffer eller rock &lsquo;n&rsquo; roll så har det ikke noe å si. Man kan via et potmeter på sensoren justere hvor høy lyden må være for at den skal reagere. Når lydsensoren oppfatter en lyd og den lyden er høy nok så gir den fra seg et digital signal (HIGH eller LOW). Så sensoren blir koblet til en digital inngang på Arduinoen.</p>

<h2 id="slik-fungerer-det:676f01acec179ba34e80d79ca9ddd325">Slik fungerer det</h2>

<p>Lydsensoren oppfatter en lyd (som er høy nok i volum) og gir fra seg et digitalt signal. Arduinoen oppfatter signalet og sender så en beskjed via 433MHz-senderen.</p>

<p>433MHz-mottakeren tar imot det trådløse radiosignalet. Arduinoen den er koblet til oppfatter dette og blinker så med LED-lyset/ene.</p>

<h3 id="video:676f01acec179ba34e80d79ca9ddd325">Video</h3>

<p>Her er en kort video som viser hvordan det fungerer. NB! Dette er første gang jeg spiller inn en video hvor jeg snakker. Den er uforbredt og klønete. Jeg filmet med mobiltelefonen og lyden ble veldig lav. Så husk å skru ned lyden igjen etterpå.</p>

<iframe width="768" height="432" src="https://www.youtube.com/embed/DW3e2ElfMIw?rel=0" frameborder="0" allowfullscreen></iframe>

<p>I videoen så ser du at jeg har koblet på et LED-lys på koblingsbrettet for senderen. Dette lyser når Arduinoen har mottatt et signal og sender et signal videre. Jeg brukte dette lyset til «feilsøking» når jeg jobbet med det. Det samme har jeg koblet på mottakeren. Et LED-lys som blinker når den mottar et signal.</p>

<h2 id="koblinger:676f01acec179ba34e80d79ca9ddd325">Koblinger</h2>

<p>Jeg har ingen skjema over koblingene siden Fritzing mangler flere at komponentene jeg har brukt. Så her kommer en kort skriftlig forklaring.</p>

<h3 id="lydsensoren:676f01acec179ba34e80d79ca9ddd325">Lydsensoren</h3>

<p>Lydsensoren er koblet til 5V, GND og D2.</p>

<h3 id="rf-senderen:676f01acec179ba34e80d79ca9ddd325">RF-senderen</h3>

<p>RF-senderen er koblet til 5V, GND og D12.</p>

<h3 id="led-på-arduino-en-som-sender:676f01acec179ba34e80d79ca9ddd325">LED på Arduino en som sender</h3>

<p>LED er koblet til D7 og GND med en motstand i mellom.</p>

<h3 id="rf-mottaker:676f01acec179ba34e80d79ca9ddd325">RF-mottaker</h3>

<p>RD-mottaker er koblet til 5V, GND og D11.</p>

<h3 id="led-på-arduino-med-mottaker:676f01acec179ba34e80d79ca9ddd325">LED på Arduino med mottaker</h3>

<p>LED er koblet til D13 og GND.</p>

<h2 id="kode:676f01acec179ba34e80d79ca9ddd325">Kode</h2>

<p>I koden under har jeg forenklet den og fjernet den delen som går på Neopixel. En enkel måte å bruke 433MHz sender og mottaker på er å bruke et bibliotek.</p>

<h3 id="radiohead:676f01acec179ba34e80d79ca9ddd325">RadioHead</h3>

<p><a href="http://www.airspayce.com/mikem/arduino/RadioHead/RadioHead-1.41.zip" title="Last ned ">RadioHead</a> gjør det enkelt å sette opp og kommunisere med 433MHz-enhetene. Det finnes flere tilsvarende bibliotek. Så du får bruke det du selv føler er best.</p>

<p>Trenger du en rask innføring så kan jeg anbefale <a href="http://randomnerdtutorials.com/rf-433mhz-transmitter-receiver-module-with-arduino/" title="Complete Guide for RF 433MHz Transmitter/Receiver Module With Arduino">denne guiden</a>.</p>

<h3 id="kode-for-lydsensor-og-sender:676f01acec179ba34e80d79ca9ddd325">Kode for lydsensor og sender</h3>

<pre>#include &#60;RH_ASK.h&#62;
#include &#60;SPI.h&#62;
RH_ASK driver;

int ledPin = 7;
int inPin = 2;
int volume = 0;

void setup() {
  Serial.begin(9600);
  pinMode(ledPin, OUTPUT);
  pinMode(inPin, INPUT);
  digitalWrite(ledPin, LOW);
    if (!driver.init())
         Serial.println("init failed");
}

void loop() {
  volume = digitalRead(inPin);
  if (volume > 0) {
    digitalWrite(ledPin, HIGH);
    const char *msg = "Hello World!";
    driver.send((uint8_t *)msg, strlen(msg));
    driver.waitPacketSent();
    delay(1000);
    digitalWrite(ledPin,LOW);
  }
}</pre>

<h3 id="kode-for-mottaker-og-neopixel:676f01acec179ba34e80d79ca9ddd325">Kode for mottaker og Neopixel</h3>

<pre>// Signal inn fra mottaker skal på pin 11.
#include &#60;RH_ASK.h&#62;
#include &#60;SPI.h&#62; // Not actualy used but needed to compile
RH_ASK driver;</pre>

<pre>// Led for å blink når signal mottatt
int led = 13;</pre>

<pre>void setup()
{
    Serial.begin(9600); // Debugging only
    pinMode(led, OUTPUT);

    if (!driver.init())
         Serial.println("init failed");
}</pre>

<pre>void loop()
{
    uint8_t buf[12];
    uint8_t buflen = sizeof(buf);
    
    if (driver.recv(buf, &buflen))
    {
      Serial.println((char*)buf);
      digitalWrite(led, HIGH);
      delay(2000);
      digitalWrite(led, LOW);      
    }
}</pre>

  <p class="small gray"><time datetime="2016-05-120">May 05, 2016</time></p>
</article>
</main>
</div>
</body>
</html>
